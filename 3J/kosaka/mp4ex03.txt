mp4ex03.txt
s12083 3J18 五味京祐

1.課題
8bitスイッチの回路図を見ると，CPUの端子からスイッチを経てGNDに接続されているだけである。
　　通常はこの回路ではスイッチの状態を読み取ることができない。
　　スイッチを読み取るプログラムの初期化部分の意味（8bitSWのプルアップ設定）とあわせてどうし
　　て可能なのか検討し，説明しなさい。
　　なおH8/3048foneハードウェアマニュアルの関連する説明を抜き出しなさい。（９．３ ポート2参照）
　　また小坂のweb文書「h8CPU_Input.html」も参考にしなさい。

2.使用したプログラム
/**********************************************************
8ビットスイッチによってLEDのON-OFFを行う
**********************************************************/
#include <3048fone.h>
#include "h8_3048fone.h"

main()
{
    initLed();
    P2.DDR = 0x00;/*8bitSWのポートを入力に設定*/
    P2.PCR.BYTE = 0xff;/*8bitSWのプルアップ設定*/
    while(1) {
        if (P2.DR.BIT.B0==0) { /*8bitSWの0がONの時*/
            turnOnLed(0);
            turnOnLed(1);
        } else if (P2.DR.BIT.B1==0) { /*8bitSWの1がONの時*/
            turnOnLed(0);
            turnOffLed(1);
        } else if (P2.DR.BIT.B2==0) { /*8bitSWの2がONの時*/
            turnOffLed(0);
            turnOnLed(1);
        } else {
            turnOffLed(0);
            turnOffLed(1);
        }
    }
}

3.考察
P2.PCR.BYTE = 0xffをすることで8bitスイッチのPCR(プルアップコントロールレジスタ)に1を入れて，8bitスイッチの値を読み取れるように設定している．
プルアップ抵抗を有効にすることで，
スイッチがONでGNDに繋がっているときは0
スイッチがOFFでGNDに繋がっていないときは1の値が読み取れる．

P2PCR は 8 ビットのリード／ライト可能なレジスタで、ポート 2 に内蔵した入力プルアップ MOS
をビットごとに制御します。
モード 5〜7 のとき、P2DDR を 0 にクリアした（入力ポートの）状態で P2PCR を 1 にセットする
と対応するビットの入力プルアップ MOS は ON します。
P2PCR は、リセット、またはハードウェアスタンバイモード時に、H'00 にイニシャライズされま
す。ソフトウェアスタンバイモード時には、直前の状態を保持します。


4.まとめ
プルアップ抵抗の役割
8bitスイッチを使用するための初期化プログラムの意味
などが理解できた．